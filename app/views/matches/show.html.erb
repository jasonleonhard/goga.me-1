<header>
<%= @match.black_user_email %> vs <%= @match.white_user_email %>
</header>

<br>
<br>
<br>

<% w = @width + BoardHelper::OFFSET %>
<svg id="board" width="<%= w %>" height="<%= w %>">
<rect xmlns="http://www.w3.org/2000/svg" width="<%= w %>" height="<%= w %>" fill="#DCB35C"/>
  <%= raw draw_board_svg(size: @match.board_size, width: @width) %>
  <%= raw draw_grid_intersection_points(size: @match.board_size, width: @width) %>
  <script type="text/javascript"><![CDATA[
    var dispatcher = new WebSocketRails('<%= @websocket_url %>');
    var channel = dispatcher.subscribe("match_" + <%= @match.id %>);

    function drawBoard(points) {
      for(var i = 0; i < points.length; i++) {
        var point = points[i];
        var id = "#" + point.x + "_" + point.y;
        if(point.color == "blank") {
          $(id).css("opacity", 0);
        } else {
          $(id).css("fill", point.color);
          $(id).css("opacity", 1);
        }
      }
    }
    dispatcher.trigger('show_board', {match_id: <%= @match.id %>});

    channel.bind('show_board', function(data) {
      console.log(data.message.error_message);
      console.log(data.message.board_state);
      drawBoard(data.message.board_state);
    });


    function handleMove(x,y) {
      <% if current_user.present? %>
        dispatcher.trigger('update_board', {match_id: <%= @match.id %>, x: x, y: y, user_id: <%= current_user.id %>});
      <% end %>
    }
  ]]></script>
</svg>

<script type="text/javascript">
</script>

